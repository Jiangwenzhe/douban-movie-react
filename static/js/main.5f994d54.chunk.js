(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{13:function(e,t,a){},20:function(e,t,a){},26:function(e,t,a){e.exports=a(44)},31:function(e,t,a){},44:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),c=a(22),r=a.n(c),s=(a(31),a(6)),i=a(7),l=a(9),u=a(8),m=a(10),h=(a(20),a(1)),d=a(15),p=a(11),v=(a(13),function(e){var t=e.info;return o.a.createElement("div",{className:"card"},o.a.createElement("a",{href:t.alt},o.a.createElement("div",{className:"cover"},o.a.createElement("img",{src:t.images.medium,alt:""})),o.a.createElement("div",{className:"detail"},o.a.createElement("h2",null,t.title),o.a.createElement("div",{className:"extra"},o.a.createElement("span",{className:"score"},t.rating.average),"\xa0/\xa0",o.a.createElement("span",{className:"collection"},t.collect_count)," \u6536\u85cf"),o.a.createElement("div",{className:"extra"},o.a.createElement("span",{className:"year"},t.year),"\xa0/\xa0",o.a.createElement("span",{className:"type"},t.genres.join("\u3001"))),o.a.createElement("div",{className:"extra"},o.a.createElement("span",{className:"director"},"\u5bfc\u6f14: ",t.directors.map(function(e){return e.name}).join("\u3001"))),o.a.createElement("div",{className:"extra"},o.a.createElement("span",{className:"casts"},"\u6f14\u5458: ",t.casts.map(function(e){return e.name}).join("\u3001"))),o.a.createElement("div",{className:"extra"}))))}),f=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.props,t=e.value,a=e.cardInfo;return o.a.createElement("div",null,o.a.createElement("h1",null,t),a.map(function(e,t){return o.a.createElement("div",{key:t},o.a.createElement(v,{info:e}))}))}}]),t}(n.Component),g=function(){return o.a.createElement("div",{className:"loading"},o.a.createElement("span",{className:"iconfont icon-jiazai_dan"}))},b=a(23),E=a.n(b),N=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={cardInfo:null,startNum:0,countNum:20,hasMore:!0,isLoading:!1,scrollpx:0},a.try_restore_component=a.try_restore_component.bind(Object(h.a)(Object(h.a)(a))),a.try_restore_component(),a.handleScroll=a.handleScroll.bind(Object(h.a)(Object(h.a)(a))),a.getTopMovieData=a.getTopMovieData.bind(Object(h.a)(Object(h.a)(a))),a.setTopMovieData=a.setTopMovieData.bind(Object(h.a)(Object(h.a)(a))),a}return Object(m.a)(t,e),Object(i.a)(t,[{key:"getTopMovieData",value:function(){var e=this,t=this.state,a=t.startNum,n=t.countNum,o=this.props.requestURL;this.setState({isLoading:!0});var c="".concat(o,"?start=").concat(a,"&count=").concat(n);E()(c,null,function(t,n){t?console.log(t):(console.log(n.subjects),e.setState({startNum:a+20,isLoading:!1}),e.setTopMovieData(n),console.log("get data startNum: ",a))})}},{key:"setTopMovieData",value:function(e){var t=this.state,a=t.cardInfo,n=t.startNum,o=t.countNum,c=t.hasMore,r=e.subjects,s=e.total;a?(this.setState({cardInfo:Array.from(new Set(a.concat(r))),hasMore:s>=n+o}),console.log(c)):this.setState({cardInfo:r})}},{key:"handleScroll",value:function(){var e=this.state,t=e.isLoading,a=e.hasMore,n="innerHeight"in window?window.innerHeight:document.documentElement.offsetHeight,o=document.body,c=document.documentElement,r=Math.max(o.scrollHeight,o.offsetHeight,c.clientHeight,c.scrollHeight,c.offsetHeight),s=n+window.pageYOffset;this.setState({scrollpx:window.pageYOffset}),s>=r&&(console.log("\u9875\u9762\u5230\u5e95\u5566"),!t&&a&&this.getTopMovieData(),console.log("\u53d1\u9001\u8bf7\u6c42\u3002\u3002\u3002"))}},{key:"try_restore_component",value:function(){var e=this.props.value,t=window.sessionStorage.getItem("".concat(e));if(console.log("try_restore_component"),t){t=JSON.parse(t),console.log(t);var a=t,n=a.cardInfo,o=a.startNum,c=a.countNum,r=a.hasMore,s=a.isLoading,i=a.scrollpx;this.state={cardInfo:n,scrollpx:i,startNum:o,countNum:c,hasMore:r,isLoading:s}}}},{key:"componentDidMount",value:function(){console.log("did Mount");var e=this.state,t=e.startNum,a=e.scrollpx;console.log("\u5728did Mount\u4e2d\u7684",a),window.addEventListener("scroll",this.handleScroll),0===t&&(console.log("\u4e00\u5f00\u59cb\u83b7\u53d6\u6570\u636e"),this.getTopMovieData()),window.scrollTo(0,a)}},{key:"componentDidUpdate",value:function(e){this.props.requestURL!==e.requestURL&&(this.setState({startNum:0,cardInfo:null}),this.getTopMovieData())}},{key:"componentWillUnmount",value:function(){console.log("unmount"),window.removeEventListener("scroll",this.handleScroll);var e=this.state,t=e.cardInfo,a=e.startNum,n=e.countNum,o=e.hasMore,c=e.scrollpx;console.log("\u4fdd\u5b58\u7684\u7535\u5f71\u6570\u636e",t),console.log("\u6eda\u52a8\u7684\u4f4d\u7f6e",c);var r={cardInfo:t,scrollpx:c,startNum:a,countNum:n,hasMore:o,isLoading:!1};window.sessionStorage.setItem("".concat(this.props.value),JSON.stringify(r))}},{key:"render",value:function(){var e=this.state,t=e.cardInfo,a=e.isLoading;return o.a.createElement("div",null,t&&o.a.createElement(f,{cardInfo:t}),a&&o.a.createElement(g,null))}}]),t}(n.Component),O=function(e){var t=e.tabName,a=e.icon,n=e.to,c=e.activeOnlyWhenExact;return o.a.createElement(p.b,{path:n,exact:c,children:function(e){var c=e.match;return o.a.createElement("div",{className:c?"active":""},o.a.createElement("span",{className:a}),o.a.createElement(d.b,{style:c?{color:"#00B51D"}:{},to:n},t))}})},y=function(){return o.a.createElement(N,{requestURL:"https://api.douban.com/v2/movie/top250",value:"topmovie"})},j=function(){return o.a.createElement(N,{requestURL:"https://api.douban.com/v2/movie/in_theaters",value:"in_theater"})},w=function(e){function t(){var e;return Object(s.a)(this,t),(e=Object(l.a)(this,Object(u.a)(t).call(this))).state={searchTerm:"",url:""},e.onSearchChange=e.onSearchChange.bind(Object(h.a)(Object(h.a)(e))),e.onSearchSubmit=e.onSearchSubmit.bind(Object(h.a)(Object(h.a)(e))),e.try_restore_component=e.try_restore_component.bind(Object(h.a)(Object(h.a)(e))),e.try_restore_component(),e}return Object(m.a)(t,e),Object(i.a)(t,[{key:"onSearchChange",value:function(e){this.setState({searchTerm:e.target.value})}},{key:"onSearchSubmit",value:function(e){var t=this.state.searchTerm;this.setState({url:"https://api.douban.com/v2/movie/search?q=".concat(t)}),this.forceUpdate()}},{key:"try_restore_component",value:function(){var e=window.sessionStorage.getItem("searchData");if(console.log(e),e){var t=e=JSON.parse(e),a=t.url,n=t.searchTerm;this.state={url:a,searchTerm:n}}}},{key:"componentWillUnmount",value:function(){var e=this.state,t=e.url,a=e.searchTerm;console.log(t);var n={url:t,searchTerm:a};window.sessionStorage.setItem("searchData",JSON.stringify(n))}},{key:"render",value:function(){var e=this.state,t=e.url,a=e.searchTerm;return o.a.createElement("div",null,o.a.createElement("div",{className:"search-area"},o.a.createElement("input",{type:"text",placeholder:"\u641c\u7d22\u7535\u5f71",value:a,onChange:this.onSearchChange}),o.a.createElement("span",{className:"button",id:"searchBtn",onClick:this.onSearchSubmit}," \u641c\u7d22")),t&&o.a.createElement(N,{requestURL:t,value:a}))}}]),t}(n.Component),S=function(){return o.a.createElement(d.a,null,o.a.createElement("div",null,o.a.createElement("footer",{className:"backdrop-blur"},o.a.createElement(O,{activeOnlyWhenExact:!0,to:"/top250",icon:"iconfont icon-paihangbang",tabName:"\u6392\u884c\u699c"}),o.a.createElement(O,{to:"/onTheater",icon:"iconfont icon-dianying",tabName:"\u6b63\u5728\u4e0a\u6620"}),o.a.createElement(O,{to:"/search",icon:"iconfont icon-search",tabName:"\u641c\u7d22"})),o.a.createElement(p.b,{exact:!0,path:"/",component:function(){return o.a.createElement(p.a,{to:"/top250"})}}),o.a.createElement(p.b,{exact:!0,path:"/top250",component:y}),o.a.createElement(p.b,{path:"/onTheater",component:j}),o.a.createElement(p.b,{path:"/search",component:w})))},k=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return o.a.createElement("div",null,o.a.createElement(S,null))}}]),t}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(o.a.createElement(k,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[26,1,2]]]);
//# sourceMappingURL=main.5f994d54.chunk.js.map